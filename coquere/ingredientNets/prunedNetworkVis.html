<!DOCTYPE HTML>
<!--
	Halcyonic 3.1 by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
		<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
		<script src="../js/query.js"></script>
		<script src="../js/config.js"></script>
		<script src="../js/skel.min.js"></script>
		<script src="../js/skel-panels.min.js"></script>
		<script src="../js/skel-tabs.min.js"></script>
		<script src = "http://d3js.org/d3.v3.min.js"></script>
		<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
		<noscript>
			<link rel="stylesheet" href="../css/skel-noscript.css" />
			<link rel="stylesheet" href="../css/style-desktop.css" />
			<link rel="stylesheet" href="css/style.css" />
		</noscript>
		<style>
			.stroke {
			  fill: none;
			  stroke: #999;
			  stroke-width: 1px;
			}

			.fill {
			  fill: #fff;
			}

			.land {
			  fill: #ddd;
			}

			.boundary {
			  fill: none;
			  stroke: #fff;
			}
		</style>

	</head>
	<body>
		<div id="chart"> </div>

		<script>
			var color = d3.scale.category20();

			var width = 1000,
			height = 1000;

			var cuisine = getQueryVariable("cuisine");
			var links = getQueryVariable("links");
		

			var svg = d3.select("#chart").append("svg")
		.attr("width", width)
		.attr("height", height)
		.attr("viewBox", "0 0 " + width + " " + height)
		.attr("preserveAspectRatio", "xMidYMid meet")
		.attr("pointer-events", "all")
		.append('svg:g')
		.call(d3.behavior.zoom().on("zoom", redraw))
		.append('svg:g');

		svg.append('svg:rect')
		.attr('width', width)
		.attr('height', height)
		.attr('fill', 'white');

		function redraw() {
			console.log("here", d3.event.translate, d3.event.scale);
			svg.attr("transform",
					"translate(" + d3.event.translate + ")"
					+ " scale(" + d3.event.scale + ")");
		}
		
		var color = d3.scale.category20();

		var loading = svg.append("text")
		.attr("x", width / 2)
		.attr("y", height / 2)
		.attr("dy", ".35em")
		.style("text-anchor", "middle")
		.text("Simulating. One moment please…");

								

		var csvFile = "data/" + cuisine + links + ".csv";
		console.log(csvFile);
		d3.csv(csvFile, function(links) {
			var nodesByName = {};
	
			// Create nodes for each unique source and target.
			links.forEach(function(link) {
			  link.source = nodeByName(link.source);
			  link.target = nodeByName(link.target);
			});

			// Extract the array of nodes from the map by name.
			var nodes = d3.values(nodesByName);

			function nodeByName(name) {
			  if (nodesByName[name] != undefined){
				nodesByName[name].degree = nodesByName[name].degree + 1;
			  }
			   
			  return nodesByName[name] || (nodesByName[name] = {name: name, degree:1});
			}
			
			var force = d3.layout.force()
			.gravity(0)
			.charge(function(node) { return Math.sqrt(node.degree)*-10;})
			.friction(1)
			.linkDistance(height/6)
			.linkStrength(0.5)
			.size([width, height]);

			// Start the force layout.
			force
			    .nodes(nodes)
			    .links(links);

	
			// Use a timeout to allow the rest of the page to load first.
			setTimeout(function() {

					n=200; 
					// Run the layout a fixed number of times.
					// The ideal number of times scales with graph complexity.
					// Of course, don't run too long—you'll hang the page!
					force.start();
					for (var i = n * n; i > 0; --i) force.tick();
					force.stop();

					var link = svg.selectAll(".link")
						.data(links)
						.enter().append("line")
						.attr("class", "link")
						.attr("x1", function(d) { return d.source.x; })
						.attr("y1", function(d) { return d.source.y; })
						.attr("x2", function(d) { return d.target.x; })
						.attr("y2", function(d) { return d.target.y; });

					var node = svg.selectAll(".node")
						.data(nodes)
						.enter().append("g")
						.attr("class", "node")
						.attr("cx", function(d) { return d.x; })
						.attr("cy", function(d) { return d.y; })
						.attr("r", 4.5)
						.on("mouseover", fade(.1))
						.on("mouseout", fade(1));

					node.append("circle")
						.attr("r", function(d){ 
							return Math.log(d.degree) *30 /Math.sqrt(nodes.length);})
						.attr("fill", function(d){return color(d.degree);})
						.attr("cx", function(d) { return d.x; })
						.attr("cy", function(d) { return d.y; });

					node.append("text")
						.attr("dx", function(d) { return d.x; })
						.attr("dy", function(d) { return d.y; })
						.attr("font-size",10)
						.style("font-weight", "bold");


					function fade(opacity){

						return function (d) {
							node.style("stroke-opacity", function(o) {
									thisOpacity = 1;//isConnected(d, o) ? 1: opacity;
									this.setAttribute('fill-opacity', thisOpacity);
									return thisOpacity;
									});
							link.style ("stroke-opacity", 1)
							link.style ("stroke", "#999")

							d3.selectAll(".node").select("text").text(function(o) {
										return  o.name.toLowerCase() ;
										})
										.attr("dx", function(d) { return d.x + 1; })
										.attr("dy", function(d) { return d.y + 0.5; });
						};

					}

					loading.remove();

				}, 10);
      });
		</script>
			
	</body>
</html>
