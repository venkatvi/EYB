<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />

		<script src = "http://d3js.org/d3.v3.min.js"></script>
		<noscript>
			<link rel="stylesheet" href="../../css/skel-noscript.css" />
			<link rel="stylesheet" href="../../css/style.css" />
			<link rel="stylesheet" href="../../css/style-results.css" />
		</noscript>	
	</head>
	<body>
		<label for="chooseNode" style="font-family:sans-serif; font-size:11px">Choose Node:</label>
		<select id="chooseNode"></select><br>
		<script>
			var width = 800,
				height = 800;

			var svg = d3.select("body").append("svg")
			.attr("width", width)
			.attr("height", height);


			var force = d3.layout.force()
			.gravity(1)
			.distance(175)
			.charge(-900)
			.size([width, height]);

			d3.json("hawaiian_leafs.json", function(error, json) {
			force
			.nodes(json.nodes)
			.links(json.links)
			.start();

			var color = d3.scale.category10();

			var dropDownNodes = new Array();
			json.nodes.forEach(function(d) {
				if (d.id ){
					dropDownNodes.push(d.id);
				}
			});

			var linkedByIndex = {};
			json.links.forEach(function (d) {
					linkedByIndex[d.source.index + "," + d.target.index] = 1;
			});
			function isConnected(a,b){
				return linkedByIndex[a.index+ "," + b.index] || linkedByIndex[b.index + "," + a.index] || a.index == b.index;
			}


			var link = svg.selectAll(".link")
			.data(json.links)
			.enter().append("line")
			.attr("class", "link");

			var node = svg.selectAll(".node")
			.data(json.nodes)
			.enter().append("g")
			.attr("class", "node")
			.call(force.drag)
			.on("mouseover", fade(.1))
			.on("mouseout", fade(1));

			node.append("circle")
			.attr("r", function(d) { return Math.sqrt(d.degree+1)*1.2 } )
			.style("fill", function(d) { return color(d.degree); });

			node.append("text")
			.attr("dx", 12)
			.attr("dy", ".35em");

			//.text(function(d) { return d.id; });

			function fade(opacity){
				return function (d) {
					node.style("stroke-opacity", function(o) {
						thisOpacity = isConnected(d, o) ? 1: opacity;
						this.setAttribute('fill-opacity', thisOpacity);
						return thisOpacity;
					});
					link.style ("stroke-opacity", function(o) {
						return o.source === d || o.target === d ? 1: opacity;
					});
					link.style ("stroke", function(o) {
						return opacity === 0.1 ? (o.source === d || o.target === d ? "#999": "#fff") : "#fff";
					});
					d3.select(this).select("text").text(function() { 
						return opacity === 0.1 ? d.id : "";
					 });
					d3.selectAll(".node").filter(function(o){
							return isConnected(o, d) == 1;
						}).select("text").text(function(o) {
							return opacity === 0.1 ? o.id : "";
						});
					
				};

			}
			force.on("tick", function()
			{
				link.attr("x1", function(d) { return d.source.x; })
				    .attr("y1", function(d) { return d.source.y; })
				    .attr("x2", function(d) { return d.target.x; })
				    .attr("y2", function(d) { return d.target.y; });
				node.attr("transform", function(d)
				{
					return "translate(" + d.x + "," + d.y + ")";
				});
			});

			});
		</script>
	</body>
</html>
